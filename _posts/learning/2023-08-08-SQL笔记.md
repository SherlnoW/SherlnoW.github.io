---
layout: post
title: ã€å­¦ä¹ ã€‘SQLåˆ·é¢˜ç¬”è®°
date: 2023-03-12 13:00
description: SQLåˆ·é¢˜è®°å½•
tag:
- å­¦ä¹ 
- SQL
- åˆ·é¢˜
---

# SQLåˆ·é¢˜ç¬”è®°

> é«˜é¢‘SQL50é¢˜ï¼ˆåŸºç¡€ï¼‰ï¼šhttps://leetcode.cn/studyplan/sql-free-50/

- [æŸ¥è¯¢](#æŸ¥è¯¢)
- [è¿æ¥](#è¿æ¥)
- [èšåˆå‡½æ•°](#èšåˆå‡½æ•°)
- [æ’åºå’Œåˆ†ç»„](#æ’åºå’Œåˆ†ç»„)
- [é«˜çº§æŸ¥è¯¢å’Œè¿æ¥](#é«˜çº§æŸ¥è¯¢å’Œè¿æ¥)
- [å­æŸ¥è¯¢](#å­æŸ¥è¯¢)
- [é«˜çº§å­—ç¬¦ä¸²å‡½æ•°ã€æ­£åˆ™è¡¨è¾¾å¼ã€å­å¥](#é«˜çº§å­—ç¬¦ä¸²å‡½æ•°ã€æ­£åˆ™è¡¨è¾¾å¼ã€å­å¥)

### æŸ¥è¯¢

##### [1757.å¯å›æ”¶ä¸”ä½è„‚çš„äº§å“](https://leetcode.cn/problems/recyclable-and-low-fat-products/)

è¡¨ï¼šProducts
```sql
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| product_id  | int     |
| low_fats    | enum    |
| recyclable  | enum    |
+-------------+---------+
product_id æ˜¯è¯¥è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
low_fats æ˜¯æšä¸¾ç±»å‹ï¼Œå–å€¼ä¸ºä»¥ä¸‹ä¸¤ç§ ('Y', 'N')ï¼Œå…¶ä¸­ 'Y' è¡¨ç¤ºè¯¥äº§å“æ˜¯ä½è„‚äº§å“ï¼Œ'N' è¡¨ç¤ºä¸æ˜¯ä½è„‚äº§å“ã€‚
recyclable æ˜¯æšä¸¾ç±»å‹ï¼Œå–å€¼ä¸ºä»¥ä¸‹ä¸¤ç§ ('Y', 'N')ï¼Œå…¶ä¸­ 'Y' è¡¨ç¤ºè¯¥äº§å“å¯å›æ”¶ï¼Œè€Œ 'N' è¡¨ç¤ºä¸å¯å›æ”¶ã€‚
```


ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡ºæ—¢æ˜¯ä½è„‚åˆæ˜¯å¯å›æ”¶çš„äº§å“ç¼–å·ã€‚

è¿”å›ç»“æœ æ— é¡ºåºè¦æ±‚ ã€‚

è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼š
Products è¡¨ï¼š
+-------------+----------+------------+
| product_id  | low_fats | recyclable |
+-------------+----------+------------+
| 0           | Y        | N          |
| 1           | Y        | Y          |
| 2           | N        | Y          |
| 3           | Y        | Y          |
| 4           | N        | N          |
+-------------+----------+------------+
è¾“å‡ºï¼š
+-------------+
| product_id  |
+-------------+
| 1           |
| 3           |
+-------------+
è§£é‡Šï¼š
åªæœ‰äº§å“ id ä¸º 1 å’Œ 3 çš„äº§å“ï¼Œæ—¢æ˜¯ä½è„‚åˆæ˜¯å¯å›æ”¶çš„äº§å“ã€‚
```

**é¢˜è§£**

```sql
select product_id from Products where low_fats = 'Y' and recyclable = 'y';
```

---

##### [584.å¯»æ‰¾ç”¨æˆ·æ¨èäºº](https://leetcode.cn/problems/find-customer-referee/?envType=study-plan-v2&envId=sql-free-50)

è¡¨ï¼šCustomer
```sql
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| name        | varchar |
| referee_id  | int     |
+-------------+---------+
åœ¨ SQL ä¸­ï¼Œid æ˜¯è¯¥è¡¨çš„ä¸»é”®åˆ—ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªå®¢æˆ·çš„ idã€å§“åä»¥åŠæ¨èä»–ä»¬çš„å®¢æˆ·çš„ idã€‚
```
æ‰¾å‡ºé‚£äº› æ²¡æœ‰è¢« id = 2 çš„å®¢æˆ· æ¨è çš„å®¢æˆ·çš„å§“åã€‚

ä»¥ ä»»æ„é¡ºåº è¿”å›ç»“æœè¡¨ã€‚

ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼š 
Customer è¡¨:
+----+------+------------+
| id | name | referee_id |
+----+------+------------+
| 1  | Will | null       |
| 2  | Jane | null       |
| 3  | Alex | 2          |
| 4  | Bill | null       |
| 5  | Zack | 1          |
| 6  | Mark | 2          |
+----+------+------------+
è¾“å‡ºï¼š
+------+
| name |
+------+
| Will |
| Jane |
| Bill |
| Zack |
+------+
```

**é¢˜è§£**

MySQL ä½¿ç”¨ä¸‰å€¼é€»è¾‘ â€”â€” TRUE, FALSE å’Œ UNKNOWNã€‚ä»»ä½•ä¸ NULL å€¼è¿›è¡Œçš„æ¯”è¾ƒéƒ½ä¼šä¸ç¬¬ä¸‰ç§å€¼ UNKNOWN åšæ¯”è¾ƒã€‚è¿™ä¸ªâ€œä»»ä½•å€¼â€åŒ…æ‹¬ NULL æœ¬èº«ï¼
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ MySQL æä¾› IS NULL å’Œ IS NOT NULL ä¸¤ç§æ“ä½œæ¥å¯¹ NULL ç‰¹æ®Šåˆ¤æ–­ã€‚

ifnull(x1,x2)æ„æ€ä¸ºï¼šå¦‚æœx1æ˜¯nullï¼Œé‚£ä¹ˆåˆ™è½¬æ¢ä¸ºx2ï¼Œå¦åˆ™ä»æ—§è¾“å‡ºx1ã€‚

```sql
select name 
from customer 
where ifnull(referee_id, 0) != 2
```

---

##### [595.å¤§çš„å›½å®¶](https://leetcode.cn/problems/big-countries/?envType=study-plan-v2&envId=sql-free-50)

è¡¨ï¼šWorld
```sql
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| name        | varchar |
| continent   | varchar |
| area        | int     |
| population  | int     |
| gdp         | bigint  |
+-------------+---------+
name æ˜¯è¯¥è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œæä¾›ï¼šå›½å®¶åç§°ã€æ‰€å±å¤§é™†ã€é¢ç§¯ã€äººå£å’Œ GDP å€¼ã€‚
```
å¦‚æœä¸€ä¸ªå›½å®¶æ»¡è¶³ä¸‹è¿°ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼Œåˆ™è®¤ä¸ºè¯¥å›½æ˜¯ å¤§å›½ ï¼š

é¢ç§¯è‡³å°‘ä¸º 300 ä¸‡å¹³æ–¹å…¬é‡Œï¼ˆå³ï¼Œ3000000 km2ï¼‰ï¼Œæˆ–è€…
äººå£è‡³å°‘ä¸º 2500 ä¸‡ï¼ˆå³ 25000000ï¼‰
ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡º å¤§å›½ çš„å›½å®¶åç§°ã€äººå£å’Œé¢ç§¯ã€‚

æŒ‰ ä»»æ„é¡ºåº è¿”å›ç»“æœè¡¨ã€‚

è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼š
World è¡¨ï¼š
+-------------+-----------+---------+------------+--------------+
| name        | continent | area    | population | gdp          |
+-------------+-----------+---------+------------+--------------+
| Afghanistan | Asia      | 652230  | 25500100   | 20343000000  |
| Albania     | Europe    | 28748   | 2831741    | 12960000000  |
| Algeria     | Africa    | 2381741 | 37100000   | 188681000000 |
| Andorra     | Europe    | 468     | 78115      | 3712000000   |
| Angola      | Africa    | 1246700 | 20609294   | 100990000000 |
+-------------+-----------+---------+------------+--------------+
è¾“å‡ºï¼š
+-------------+------------+---------+
| name        | population | area    |
+-------------+------------+---------+
| Afghanistan | 25500100   | 652230  |
| Algeria     | 37100000   | 2381741 |
+-------------+------------+---------+
```

**é¢˜è§£**

```sql
select name, population, area from World 
where area >= 3000000 or population >= 25000000;
```

---

##### [1148.æ–‡ç« æµè§ˆâ… ](https://leetcode.cn/problems/article-views-i/?envType=study-plan-v2&envId=sql-free-50)

è¡¨ï¼šViews
```sql
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| article_id    | int     |
| author_id     | int     |
| viewer_id     | int     |
| view_date     | date    |
+---------------+---------+
æ­¤è¡¨å¯èƒ½ä¼šå­˜åœ¨é‡å¤è¡Œã€‚ï¼ˆæ¢å¥è¯è¯´ï¼Œåœ¨ SQL ä¸­è¿™ä¸ªè¡¨æ²¡æœ‰ä¸»é”®ï¼‰
æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºæŸäººåœ¨æŸå¤©æµè§ˆäº†æŸä½ä½œè€…çš„æŸç¯‡æ–‡ç« ã€‚
è¯·æ³¨æ„ï¼ŒåŒä¸€äººçš„ author_id å’Œ viewer_id æ˜¯ç›¸åŒçš„ã€‚
```
è¯·æŸ¥è¯¢å‡ºæ‰€æœ‰æµè§ˆè¿‡è‡ªå·±æ–‡ç« çš„ä½œè€…

ç»“æœæŒ‰ç…§ id å‡åºæ’åˆ—ã€‚

æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼š
Views è¡¨ï¼š
+------------+-----------+-----------+------------+
| article_id | author_id | viewer_id | view_date  |
+------------+-----------+-----------+------------+
| 1          | 3         | 5         | 2019-08-01 |
| 1          | 3         | 6         | 2019-08-02 |
| 2          | 7         | 7         | 2019-08-01 |
| 2          | 7         | 6         | 2019-08-02 |
| 4          | 7         | 1         | 2019-07-22 |
| 3          | 4         | 4         | 2019-07-21 |
| 3          | 4         | 4         | 2019-07-21 |
+------------+-----------+-----------+------------+

è¾“å‡ºï¼š
+------+
| id   |
+------+
| 4    |
| 7    |
+------+
```

**é¢˜è§£**

ä½¿ç”¨ `DISTINCT` å…³é”®å­—æ¥ä»è¡¨ Views ä¸­æ£€ç´¢å”¯ä¸€å…ƒç´ ã€‚

```sql
select distinct viewer_id  as id from Views 
where author_id = viewer_id order by id;
```

---

##### [1683.æ— æ•ˆçš„æ¨æ–‡](https://leetcode.cn/problems/invalid-tweets/?envType=study-plan-v2&envId=sql-free-50)

è¡¨ï¼šTweets
```sql
+----------------+---------+
| Column Name    | Type    |
+----------------+---------+
| tweet_id       | int     |
| content        | varchar |
+----------------+---------+
åœ¨ SQL ä¸­ï¼Œtweet_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
è¿™ä¸ªè¡¨åŒ…å«æŸç¤¾äº¤åª’ä½“ App ä¸­æ‰€æœ‰çš„æ¨æ–‡ã€‚
```
æŸ¥è¯¢æ‰€æœ‰æ— æ•ˆæ¨æ–‡çš„ç¼–å·ï¼ˆIDï¼‰ã€‚å½“æ¨æ–‡å†…å®¹ä¸­çš„å­—ç¬¦æ•°ä¸¥æ ¼å¤§äº 15 æ—¶ï¼Œè¯¥æ¨æ–‡æ˜¯æ— æ•ˆçš„ã€‚

ä»¥ä»»æ„é¡ºåºè¿”å›ç»“æœè¡¨ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼š
Tweets è¡¨ï¼š
+----------+----------------------------------+
| tweet_id | content                          |
+----------+----------------------------------+
| 1        | Vote for Biden                   |
| 2        | Let us make America great again! |
+----------+----------------------------------+

è¾“å‡ºï¼š
+----------+
| tweet_id |
+----------+
| 2        |
+----------+
è§£é‡Šï¼š
æ¨æ–‡ 1 çš„é•¿åº¦ length = 14ã€‚è¯¥æ¨æ–‡æ˜¯æœ‰æ•ˆçš„ã€‚
æ¨æ–‡ 2 çš„é•¿åº¦ length = 32ã€‚è¯¥æ¨æ–‡æ˜¯æ— æ•ˆçš„ã€‚
```

**é¢˜è§£**

å¯¹äºSQLè¡¨ï¼Œç”¨äºè®¡ç®—å­—ç¬¦ä¸²ä¸­å­—ç¬¦æ•°çš„æœ€ä½³å‡½æ•°æ˜¯ CHAR_LENGTH(str)ï¼Œå®ƒè¿”å›å­—ç¬¦ä¸² str çš„é•¿åº¦ã€‚

å¦ä¸€ä¸ªå¸¸ç”¨çš„å‡½æ•° LENGTH(str) åœ¨è¿™ä¸ªé—®é¢˜ä¸­ä¹Ÿé€‚ç”¨ï¼Œå› ä¸ºåˆ— content åªåŒ…å«è‹±æ–‡å­—ç¬¦ï¼Œæ²¡æœ‰ç‰¹æ®Šå­—ç¬¦ã€‚å¦åˆ™ï¼ŒLENGTH() å¯èƒ½ä¼šè¿”å›ä¸åŒçš„ç»“æœï¼Œå› ä¸ºè¯¥å‡½æ•°è¿”å›å­—ç¬¦ä¸² str çš„å­—èŠ‚æ•°ï¼ŒæŸäº›å­—ç¬¦åŒ…å«å¤šäº 1 ä¸ªå­—èŠ‚ã€‚

ä»¥å­—ç¬¦ 'Â¥' ä¸ºä¾‹ï¼šCHAR_LENGTH() è¿”å›ç»“æœä¸º 1ï¼Œè€Œ LENGTH() è¿”å›ç»“æœä¸º 2ï¼Œå› ä¸ºè¯¥å­—ç¬¦ä¸²åŒ…å« 2 ä¸ªå­—èŠ‚ã€‚

```sql
select tweet_id from Tweets where length(content) > 15;
```

---

### è¿æ¥

##### [1378.ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID](https://leetcode.cn/problems/replace-employee-id-with-the-unique-identifier/?envType=study-plan-v2&envId=sql-free-50)

Employees è¡¨ï¼š
```sql
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| name          | varchar |
+---------------+---------+
åœ¨ SQL ä¸­ï¼Œid æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚
è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œåˆ†åˆ«ä»£è¡¨äº†æŸå…¬å¸å…¶ä¸­ä¸€ä½å‘˜å·¥çš„åå­—å’Œ ID ã€‚
```

EmployeeUNI è¡¨ï¼š

```sql
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| unique_id     | int     |
+---------------+---------+
åœ¨ SQL ä¸­ï¼Œ(id, unique_id) æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚
è¿™å¼ è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«äº†è¯¥å…¬å¸æŸä½å‘˜å·¥çš„ ID å’Œä»–çš„å”¯ä¸€æ ‡è¯†ç ï¼ˆunique IDï¼‰ã€‚
```

å±•ç¤ºæ¯ä½ç”¨æˆ·çš„ å”¯ä¸€æ ‡è¯†ç ï¼ˆunique ID ï¼‰ï¼›å¦‚æœæŸä½å‘˜å·¥æ²¡æœ‰å”¯ä¸€æ ‡è¯†ç ï¼Œä½¿ç”¨ null å¡«å……å³å¯ã€‚

ä½ å¯ä»¥ä»¥ ä»»æ„ é¡ºåºè¿”å›ç»“æœè¡¨ã€‚

è¿”å›ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼š
Employees è¡¨:
+----+----------+
| id | name     |
+----+----------+
| 1  | Alice    |
| 7  | Bob      |
| 11 | Meir     |
| 90 | Winston  |
| 3  | Jonathan |
+----+----------+
EmployeeUNI è¡¨:
+----+-----------+
| id | unique_id |
+----+-----------+
| 3  | 1         |
| 11 | 2         |
| 90 | 3         |
+----+-----------+
è¾“å‡ºï¼š
+-----------+----------+
| unique_id | name     |
+-----------+----------+
| null      | Alice    |
| null      | Bob      |
| 2         | Meir     |
| 3         | Winston  |
| 1         | Jonathan |
+-----------+----------+
è§£é‡Šï¼š
Alice and Bob æ²¡æœ‰å”¯ä¸€æ ‡è¯†ç , å› æ­¤æˆ‘ä»¬ä½¿ç”¨ null æ›¿ä»£ã€‚
Meir çš„å”¯ä¸€æ ‡è¯†ç æ˜¯ 2 ã€‚
Winston çš„å”¯ä¸€æ ‡è¯†ç æ˜¯ 3 ã€‚
Jonathan å”¯ä¸€æ ‡è¯†ç æ˜¯ 1 ã€‚
```

**é¢˜è§£**

ã€Œå·¦å¤–è¿æ¥ã€ç”¨äºä¸ä»…è¿”å›æ»¡è¶³è¿æ¥æ¡ä»¶çš„æ‰€æœ‰è®°å½•ï¼Œè€Œä¸”è¿˜è¿”å›ä¸æ»¡è¶³è¿æ¥æ¡ä»¶çš„è¿æ¥æ“ä½œç¬¦å·¦è¾¹è¡¨çš„å…¶ä»–è¡Œã€‚

```sql
select uni.unique_id, e.name 
from Employees e left join EmployeeUNI uni on e.id = uni.id;
```

---

##### [1068.ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID](https://leetcode.cn/problems/product-sales-analysis-i/?envType=study-plan-v2&envId=sql-free-50)

é”€å”®è¡¨ Salesï¼š
```sql
+-------------+-------+
| Column Name | Type  |
+-------------+-------+
| sale_id     | int   |
| product_id  | int   |
| year        | int   |
| quantity    | int   |
| price       | int   |
+-------------+-------+
(sale_id, year) æ˜¯é”€å”®è¡¨ Sales çš„ä¸»é”®.
product_id æ˜¯å…³è”åˆ°äº§å“è¡¨ Product çš„å¤–é”®.
æ³¨æ„: price è¡¨ç¤ºæ¯å•ä½ä»·æ ¼
```

äº§å“è¡¨ Productï¼š

```sql
+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| product_id   | int     |
| product_name | varchar |
+--------------+---------+
product_id æ˜¯è¡¨çš„ä¸»é”®.
```

å†™ä¸€æ¡SQL æŸ¥è¯¢è¯­å¥è·å– Sales è¡¨ä¸­æ‰€æœ‰äº§å“å¯¹åº”çš„ äº§å“åç§° product_name ä»¥åŠè¯¥äº§å“çš„æ‰€æœ‰ å”®å–å¹´ä»½ yearÂ å’Œ ä»·æ ¼ price ã€‚

æŸ¥è¯¢ç»“æœä¸­çš„é¡ºåºæ— ç‰¹å®šè¦æ±‚ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼ç¤ºä¾‹å¦‚ä¸‹ï¼š

ç¤ºä¾‹ 1ï¼š
```
Sales è¡¨ï¼š
+---------+------------+------+----------+-------+
| sale_id | product_id | year | quantity | price |
+---------+------------+------+----------+-------+ 
| 1       | 100        | 2008 | 10       | 5000  |
| 2       | 100        | 2009 | 12       | 5000  |
| 7       | 200        | 2011 | 15       | 9000  |
+---------+------------+------+----------+-------+

Product è¡¨ï¼š
+------------+--------------+
| product_id | product_name |
+------------+--------------+
| 100        | Nokia        |
| 200        | Apple        |
| 300        | Samsung      |
+------------+--------------+

Result è¡¨ï¼š
+--------------+-------+-------+
| product_name | year  | price |
+--------------+-------+-------+
| Nokia        | 2008  | 5000  |
| Nokia        | 2009  | 5000  |
| Apple        | 2011  | 9000  |
+--------------+-------+-------+
```

**é¢˜è§£**

è¿™ä¸ªé¢˜ç›®ç”¨å†…è¿æ¥(inner join)æˆ–å·¦è¿æ¥(left join)éƒ½å¯ä»¥ï¼šå› ä¸ºä¸¤å¼ è¡¨ä¹‹é—´å­˜åœ¨å¤–é”®çº¦æŸã€‚å¤–é”®çº¦æŸäº†ä¸¤å¼ è¡¨æ•°æ®çš„å®Œæ•´æ€§ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°nullçš„æƒ…å†µã€‚
1. å¤–é”®åªæ˜¯çº¦æŸä½œç”¨ï¼Œå¹¶ä¸èµ·å…³è”ä½œç”¨ã€‚è¡¨å’Œè¡¨çš„å…³è”æ˜¯é€šè¿‡å…³è”è¯­å¥å®ç°çš„ã€‚
2. å¤–é”®æ¶ˆè€—èµ„æºï¼Œå¯èƒ½ä¼šé€ æˆæ­»é”ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ã€‚
```sql
select product_name, year, price from Sales s 
inner join Product p on s.product_id = p.product_id;
```

---

##### [1581.è¿›åº—å´ä»æœªè¿›è¡Œäº¤æ˜“çš„é¡¾å®¢](https://leetcode.cn/problems/customer-who-visited-but-did-not-make-any-transactions/?envType=study-plan-v2&envId=sql-free-50)

è¡¨ï¼šVisits
```sql
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| visit_id    | int     |
| customer_id | int     |
+-------------+---------+
visit_id æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
è¯¥è¡¨åŒ…å«æœ‰å…³å…‰ä¸´è¿‡è´­ç‰©ä¸­å¿ƒçš„é¡¾å®¢çš„ä¿¡æ¯ã€‚
```

è¡¨ï¼šTransactions
```sql
+----------------+---------+
| Column Name    | Type    |
+----------------+---------+
| transaction_id | int     |
| visit_id       | int     |
| amount         | int     |
+----------------+---------+
transaction_id æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚
æ­¤è¡¨åŒ…å« visit_id æœŸé—´è¿›è¡Œçš„äº¤æ˜“çš„ä¿¡æ¯ã€‚
```

æœ‰ä¸€äº›é¡¾å®¢å¯èƒ½å…‰é¡¾äº†è´­ç‰©ä¸­å¿ƒä½†æ²¡æœ‰è¿›è¡Œäº¤æ˜“ã€‚è¯·ä½ ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ¥æŸ¥æ‰¾è¿™äº›é¡¾å®¢çš„ ID ï¼Œä»¥åŠä»–ä»¬åªå…‰é¡¾ä¸äº¤æ˜“çš„æ¬¡æ•°ã€‚

è¿”å›ä»¥ ä»»ä½•é¡ºåº æ’åºçš„ç»“æœè¡¨ã€‚

æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥:
Visits
+----------+-------------+
| visit_id | customer_id |
+----------+-------------+
| 1        | 23          |
| 2        | 9           |
| 4        | 30          |
| 5        | 54          |
| 6        | 96          |
| 7        | 54          |
| 8        | 54          |
+----------+-------------+
Transactions
+----------------+----------+--------+
| transaction_id | visit_id | amount |
+----------------+----------+--------+
| 2              | 5        | 310    |
| 3              | 5        | 300    |
| 9              | 5        | 200    |
| 12             | 1        | 910    |
| 13             | 2        | 970    |
+----------------+----------+--------+
è¾“å‡º:
+-------------+----------------+
| customer_id | count_no_trans |
+-------------+----------------+
| 54          | 2              |
| 30          | 1              |
| 96          | 1              |
+-------------+----------------+
è§£é‡Š:
ID = 23 çš„é¡¾å®¢æ›¾ç»é€›è¿‡ä¸€æ¬¡è´­ç‰©ä¸­å¿ƒï¼Œå¹¶åœ¨ ID = 12 çš„è®¿é—®æœŸé—´è¿›è¡Œäº†ä¸€ç¬”äº¤æ˜“ã€‚
ID = 9 çš„é¡¾å®¢æ›¾ç»é€›è¿‡ä¸€æ¬¡è´­ç‰©ä¸­å¿ƒï¼Œå¹¶åœ¨ ID = 13 çš„è®¿é—®æœŸé—´è¿›è¡Œäº†ä¸€ç¬”äº¤æ˜“ã€‚
ID = 30 çš„é¡¾å®¢æ›¾ç»å»è¿‡è´­ç‰©ä¸­å¿ƒï¼Œå¹¶ä¸”æ²¡æœ‰è¿›è¡Œä»»ä½•äº¤æ˜“ã€‚
ID = 54 çš„é¡¾å®¢ä¸‰åº¦é€ è®¿äº†è´­ç‰©ä¸­å¿ƒã€‚åœ¨ 2 æ¬¡è®¿é—®ä¸­ï¼Œä»–ä»¬æ²¡æœ‰è¿›è¡Œä»»ä½•äº¤æ˜“ï¼Œåœ¨ 1 æ¬¡è®¿é—®ä¸­ï¼Œä»–ä»¬è¿›è¡Œäº† 3 æ¬¡äº¤æ˜“ã€‚
ID = 96 çš„é¡¾å®¢æ›¾ç»å»è¿‡è´­ç‰©ä¸­å¿ƒï¼Œå¹¶ä¸”æ²¡æœ‰è¿›è¡Œä»»ä½•äº¤æ˜“ã€‚
å¦‚æˆ‘ä»¬æ‰€è§ï¼ŒID ä¸º 30 å’Œ 96 çš„é¡¾å®¢ä¸€æ¬¡æ²¡æœ‰è¿›è¡Œä»»ä½•äº¤æ˜“å°±å»äº†è´­ç‰©ä¸­å¿ƒã€‚é¡¾å®¢ 54 ä¹Ÿä¸¤æ¬¡è®¿é—®äº†è´­ç‰©ä¸­å¿ƒå¹¶ä¸”æ²¡æœ‰è¿›è¡Œä»»ä½•äº¤æ˜“ã€‚
```

**é¢˜è§£**

å…ˆçœ‹æ‡‚é¢˜ç›®ï¼Œå†ä¸€æ­¥ä¸€æ­¥æ¥å†™SQLã€‚

æœ‰æ—¶å€™è‡ªè®¤ä¸ºâ€œä¸€æ­¥åˆ°ä½â€è€Œå¾—åˆ°çš„ç»“æœå¾€å¾€æ˜¯â€œå››ä¸åƒâ€ğŸ¤”
```sql
select customer_id, count(visit_id) as count_no_trans from Visits v 
where visit_id not in (select visit_id from Transactions) 
group by customer_id;
```

---

##### [197.ä¸Šå‡çš„æ¸©åº¦](https://leetcode.cn/problems/rising-temperature/?envType=study-plan-v2&envId=sql-free-50)

è¡¨ï¼š Weather
```sql
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| recordDate    | date    |
| temperature   | int     |
+---------------+---------+
åœ¨ SQL ä¸­ï¼Œid æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
è¯¥è¡¨åŒ…å«ç‰¹å®šæ—¥æœŸçš„æ¸©åº¦ä¿¡æ¯
```

æ‰¾å‡ºä¸ä¹‹å‰ï¼ˆæ˜¨å¤©çš„ï¼‰æ—¥æœŸç›¸æ¯”æ¸©åº¦æ›´é«˜çš„æ‰€æœ‰æ—¥æœŸçš„ id ã€‚

è¿”å›ç»“æœ æ— é¡ºåºè¦æ±‚ ã€‚

ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹å­æ‰€ç¤ºã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼š
Weather è¡¨ï¼š
+----+------------+-------------+
| id | recordDate | Temperature |
+----+------------+-------------+
| 1  | 2015-01-01 | 10          |
| 2  | 2015-01-02 | 25          |
| 3  | 2015-01-03 | 20          |
| 4  | 2015-01-04 | 30          |
+----+------------+-------------+
è¾“å‡ºï¼š
+----+
| id |
+----+
| 2  |
| 4  |
+----+
è§£é‡Šï¼š
2015-01-02 çš„æ¸©åº¦æ¯”å‰ä¸€å¤©é«˜ï¼ˆ10 -> 25ï¼‰
2015-01-04 çš„æ¸©åº¦æ¯”å‰ä¸€å¤©é«˜ï¼ˆ20 -> 30ï¼‰
```

**é¢˜è§£**

DATEDIFF() å‡½æ•°è¿”å›ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„æ—¶é—´ã€‚

```sql
select w2.id
from Weather w1, Weather w2
where datediff(w2.recordDate, w1.recordDate) = 1 and w2.Temperature > w1.Temperature
```

---

##### [1661.æ¯å°æœºå™¨çš„è¿›ç¨‹å¹³å‡è¿è¡Œæ—¶é—´](https://leetcode.cn/problems/average-time-of-process-per-machine/?envType=study-plan-v2&envId=sql-free-50)

è¡¨: Activity
```sql
+----------------+---------+
| Column Name    | Type    |
+----------------+---------+
| machine_id     | int     |
| process_id     | int     |
| activity_type  | enum    |
| timestamp      | float   |
+----------------+---------+
è¯¥è¡¨å±•ç¤ºäº†ä¸€å®¶å·¥å‚ç½‘ç«™çš„ç”¨æˆ·æ´»åŠ¨.
(machine_id, process_id, activity_type) æ˜¯å½“å‰è¡¨çš„ä¸»é”®.
machine_id æ˜¯ä¸€å°æœºå™¨çš„IDå·.
process_id æ˜¯è¿è¡Œåœ¨å„æœºå™¨ä¸Šçš„è¿›ç¨‹IDå·.
activity_type æ˜¯æšä¸¾ç±»å‹ ('start', 'end').
timestamp æ˜¯æµ®ç‚¹ç±»å‹,ä»£è¡¨å½“å‰æ—¶é—´(ä»¥ç§’ä¸ºå•ä½).
'start' ä»£è¡¨è¯¥è¿›ç¨‹åœ¨è¿™å°æœºå™¨ä¸Šçš„å¼€å§‹è¿è¡Œæ—¶é—´æˆ³ , 'end' ä»£è¡¨è¯¥è¿›ç¨‹åœ¨è¿™å°æœºå™¨ä¸Šçš„ç»ˆæ­¢è¿è¡Œæ—¶é—´æˆ³.
åŒä¸€å°æœºå™¨ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€å¯¹å¼€å§‹æ—¶é—´æˆ³å’Œç»“æŸæ—¶é—´æˆ³ï¼Œè€Œä¸”å¼€å§‹æ—¶é—´æˆ³æ°¸è¿œåœ¨ç»“æŸæ—¶é—´æˆ³å‰é¢.
```

ç°åœ¨æœ‰ä¸€ä¸ªå·¥å‚ç½‘ç«™ç”±å‡ å°æœºå™¨è¿è¡Œï¼Œæ¯å°æœºå™¨ä¸Šè¿è¡Œç€ç›¸åŒæ•°é‡çš„è¿›ç¨‹. è¯·å†™å‡ºä¸€æ¡SQLè®¡ç®—æ¯å°æœºå™¨å„è‡ªå®Œæˆä¸€ä¸ªè¿›ç¨‹ä»»åŠ¡çš„å¹³å‡è€—æ—¶.

å®Œæˆä¸€ä¸ªè¿›ç¨‹ä»»åŠ¡çš„æ—¶é—´æŒ‡è¿›ç¨‹çš„'end' æ—¶é—´æˆ³ å‡å»Â 'start' æ—¶é—´æˆ³. å¹³å‡è€—æ—¶é€šè¿‡è®¡ç®—æ¯å°æœºå™¨ä¸Šæ‰€æœ‰è¿›ç¨‹ä»»åŠ¡çš„æ€»è€—è´¹æ—¶é—´é™¤ä»¥æœºå™¨ä¸Šçš„æ€»è¿›ç¨‹æ•°é‡è·å¾—.

ç»“æœè¡¨å¿…é¡»åŒ…å«machine_idï¼ˆæœºå™¨IDï¼‰ å’Œå¯¹åº”çš„Â average timeï¼ˆå¹³å‡è€—æ—¶ï¼‰Â åˆ«åÂ processing_time, ä¸”å››èˆäº”å…¥ä¿ç•™3ä½å°æ•°.

ä»¥ ä»»æ„é¡ºåº è¿”å›è¡¨ã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼š
Activity table:
+------------+------------+---------------+-----------+
| machine_id | process_id | activity_type | timestamp |
+------------+------------+---------------+-----------+
| 0          | 0          | start         | 0.712     |
| 0          | 0          | end           | 1.520     |
| 0          | 1          | start         | 3.140     |
| 0          | 1          | end           | 4.120     |
| 1          | 0          | start         | 0.550     |
| 1          | 0          | end           | 1.550     |
| 1          | 1          | start         | 0.430     |
| 1          | 1          | end           | 1.420     |
| 2          | 0          | start         | 4.100     |
| 2          | 0          | end           | 4.512     |
| 2          | 1          | start         | 2.500     |
| 2          | 1          | end           | 5.000     |
+------------+------------+---------------+-----------+
è¾“å‡ºï¼š
+------------+-----------------+
| machine_id | processing_time |
+------------+-----------------+
| 0          | 0.894           |
| 1          | 0.995           |
| 2          | 1.456           |
+------------+-----------------+
è§£é‡Šï¼š
ä¸€å…±æœ‰3å°æœºå™¨,æ¯å°æœºå™¨è¿è¡Œç€ä¸¤ä¸ªè¿›ç¨‹.
æœºå™¨ 0 çš„å¹³å‡è€—æ—¶: ((1.520 - 0.712) + (4.120 - 3.140)) / 2 = 0.894
æœºå™¨ 1 çš„å¹³å‡è€—æ—¶: ((1.550 - 0.550) + (1.420 - 0.430)) / 2 = 0.995
æœºå™¨ 2 çš„å¹³å‡è€—æ—¶: ((4.512 - 4.100) + (5.000 - 2.500)) / 2 = 1.456
```

**é¢˜è§£**

* `ROUND(value, n)`ï¼šä¿ç•™æŒ‡å®šæ•°å€¼(value)çš„å°æ•°ç‚¹å n ä½(å››èˆäº”å…¥ï¼Œä¸è¶³è¡¥0)
* `avg(v1, v2, v3)`ï¼šè®¡ç®— v1ï¼Œv2, v3 çš„å¹³å‡å€¼(ç”±äºè®¡ç®—çš„æ˜¯ä¸¤ç»„æ•°æ®çš„å¹³å‡å€¼ï¼Œæ‰€ä»¥AVGåšçš„æ˜¯é™¤ä»¥4çš„æ“ä½œï¼Œå› æ­¤éœ€è¦ * 2)
* `IF(condition, value_if_true, value_if_false)`ï¼šç”¨äºæ ¹æ®æ¡ä»¶è¿”å›ä¸åŒçš„å€¼ã€‚

```sql
SELECT machine_id,
       round(avg(IF(activity_type = 'start', -timestamp, +timestamp)) * 2, 3 ) processing_time 
FROM Activity 
GROUP BY machine_id;
```

---

##### [577.å‘˜å·¥å¥–é‡‘](https://leetcode.cn/problems/employee-bonus/?envType=study-plan-v2&envId=sql-free-50)

Employee è¡¨å•
```sql
+-------+--------+-----------+--------+
| empId |  name  | supervisor| salary |
+-------+--------+-----------+--------+
|   1   | John   |  3        | 1000   |
|   2   | Dan    |  3        | 2000   |
|   3   | Brad   |  null     | 4000   |
|   4   | Thomas |  3        | 4000   |
+-------+--------+-----------+--------+
empId æ˜¯è¿™å¼ è¡¨å•çš„ä¸»å…³é”®å­—
```

Bonus è¡¨å•
```sql
+-------+-------+
| empId | bonus |
+-------+-------+
| 2     | 500   |
| 4     | 2000  |
+-------+-------+
empId æ˜¯è¿™å¼ è¡¨å•çš„ä¸»å…³é”®å­—
```

é€‰å‡ºæ‰€æœ‰ bonus < 1000 çš„å‘˜å·¥çš„ name åŠå…¶ bonusã€‚

ç¤ºä¾‹ 1ï¼š
```
+-------+-------+
| name  | bonus |
+-------+-------+
| John  | null  |
| Dan   | 500   |
| Brad  | null  |
+-------+-------+
```

**é¢˜è§£**

```sql
select name, bonus from Employee e left join Bonus b on e.empId = b.empId 
where ifnull(bonus, 0) < 1000
```

---

##### [1280.å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°](https://leetcode.cn/problems/students-and-examinations/?envType=study-plan-v2&envId=sql-free-50)

å­¦ç”Ÿè¡¨: Students
```sql
+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| student_id    | int     |
| student_name  | varchar |
+---------------+---------+
åœ¨ SQL ä¸­ï¼Œä¸»é”®ä¸º student_idï¼ˆå­¦ç”ŸIDï¼‰ã€‚
è¯¥è¡¨å†…çš„æ¯ä¸€è¡Œéƒ½è®°å½•æœ‰å­¦æ ¡ä¸€åå­¦ç”Ÿçš„ä¿¡æ¯ã€‚
```

ç§‘ç›®è¡¨: Subjects
```sql
+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| subject_name | varchar |
+--------------+---------+
åœ¨ SQL ä¸­ï¼Œä¸»é”®ä¸º subject_nameï¼ˆç§‘ç›®åç§°ï¼‰ã€‚
æ¯ä¸€è¡Œè®°å½•å­¦æ ¡çš„ä¸€é—¨ç§‘ç›®åç§°ã€‚
```

è€ƒè¯•è¡¨: Examinations
```sql
+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| student_id   | int     |
| subject_name | varchar |
+--------------+---------+
è¿™ä¸ªè¡¨å¯èƒ½åŒ…å«é‡å¤æ•°æ®ï¼ˆæ¢å¥è¯è¯´ï¼Œåœ¨ SQL ä¸­ï¼Œè¿™ä¸ªè¡¨æ²¡æœ‰ä¸»é”®ï¼‰ã€‚
å­¦ç”Ÿè¡¨é‡Œçš„ä¸€ä¸ªå­¦ç”Ÿä¿®è¯»ç§‘ç›®è¡¨é‡Œçš„æ¯ä¸€é—¨ç§‘ç›®ã€‚
è¿™å¼ è€ƒè¯•è¡¨çš„æ¯ä¸€è¡Œè®°å½•å°±è¡¨ç¤ºå­¦ç”Ÿè¡¨é‡Œçš„æŸä¸ªå­¦ç”Ÿå‚åŠ äº†ä¸€æ¬¡ç§‘ç›®è¡¨é‡ŒæŸé—¨ç§‘ç›®çš„æµ‹è¯•ã€‚
```

æŸ¥è¯¢å‡ºæ¯ä¸ªå­¦ç”Ÿå‚åŠ æ¯ä¸€é—¨ç§‘ç›®æµ‹è¯•çš„æ¬¡æ•°ï¼Œç»“æœæŒ‰ student_id å’Œ subject_name æ’åºã€‚

æŸ¥è¯¢ç»“æ„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼š
Students table:
+------------+--------------+
| student_id | student_name |
+------------+--------------+
| 1          | Alice        |
| 2          | Bob          |
| 13         | John         |
| 6          | Alex         |
+------------+--------------+
Subjects table:
+--------------+
| subject_name |
+--------------+
| Math         |
| Physics      |
| Programming  |
+--------------+
Examinations table:
+------------+--------------+
| student_id | subject_name |
+------------+--------------+
| 1          | Math         |
| 1          | Physics      |
| 1          | Programming  |
| 2          | Programming  |
| 1          | Physics      |
| 1          | Math         |
| 13         | Math         |
| 13         | Programming  |
| 13         | Physics      |
| 2          | Math         |
| 1          | Math         |
+------------+--------------+
è¾“å‡ºï¼š
+------------+--------------+--------------+----------------+
| student_id | student_name | subject_name | attended_exams |
+------------+--------------+--------------+----------------+
| 1          | Alice        | Math         | 3              |
| 1          | Alice        | Physics      | 2              |
| 1          | Alice        | Programming  | 1              |
| 2          | Bob          | Math         | 1              |
| 2          | Bob          | Physics      | 0              |
| 2          | Bob          | Programming  | 1              |
| 6          | Alex         | Math         | 0              |
| 6          | Alex         | Physics      | 0              |
| 6          | Alex         | Programming  | 0              |
| 13         | John         | Math         | 1              |
| 13         | John         | Physics      | 1              |
| 13         | John         | Programming  | 1              |
+------------+--------------+--------------+----------------+
è§£é‡Šï¼š
ç»“æœè¡¨éœ€åŒ…å«æ‰€æœ‰å­¦ç”Ÿå’Œæ‰€æœ‰ç§‘ç›®ï¼ˆå³ä¾¿æµ‹è¯•æ¬¡æ•°ä¸º0ï¼‰ï¼š
Alice å‚åŠ äº† 3 æ¬¡æ•°å­¦æµ‹è¯•, 2 æ¬¡ç‰©ç†æµ‹è¯•ï¼Œä»¥åŠ 1 æ¬¡ç¼–ç¨‹æµ‹è¯•ï¼›
Bob å‚åŠ äº† 1 æ¬¡æ•°å­¦æµ‹è¯•, 1 æ¬¡ç¼–ç¨‹æµ‹è¯•ï¼Œæ²¡æœ‰å‚åŠ ç‰©ç†æµ‹è¯•ï¼›
Alex å•¥æµ‹è¯•éƒ½æ²¡å‚åŠ ï¼›
John  å‚åŠ äº†æ•°å­¦ã€ç‰©ç†ã€ç¼–ç¨‹æµ‹è¯•å„ 1 æ¬¡ã€‚
```

**é¢˜è§£**

```sql

```

---

### èšåˆå‡½æ•°

---

### æ’åºå’Œåˆ†ç»„


---

### é«˜çº§æŸ¥è¯¢å’Œè¿æ¥


---

### å­æŸ¥è¯¢


---

### é«˜çº§å­—ç¬¦ä¸²å‡½æ•°ã€æ­£åˆ™è¡¨è¾¾å¼ã€å­å¥